<?xml version="1.0"?>
<configuration>
  <!-- These configuration sections tell .NET how to handle the FiftyOne.Foundation.Mobile.wurfl
  configuration settings further down the web.config file -->
  <configSections>
    <sectionGroup name="fiftyOne">
      <section name="log" type="FiftyOne.Foundation.Mobile.Configuration.LogSection, FiftyOne.Foundation" requirePermission="false" allowDefinition="Everywhere" restartOnExternalChanges="false" allowExeDefinition="MachineToApplication"/>
      <section name="redirect" type="FiftyOne.Foundation.Mobile.Configuration.RedirectSection, FiftyOne.Foundation" requirePermission="false" allowDefinition="Everywhere" restartOnExternalChanges="false" allowExeDefinition="MachineToApplication"/>
      <section name="wurfl" type="FiftyOne.Foundation.Mobile.Detection.Wurfl.Configuration.WurflSection, FiftyOne.Foundation" requirePermission="false" allowDefinition="Everywhere" restartOnExternalChanges="false" allowExeDefinition="MachineToApplication"/>
    </sectionGroup>
    <sectionGroup name="applicationSettings" type="System.Configuration.ApplicationSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >
      <section name="Detector.Properties.Settings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" requirePermission="false" />
    </sectionGroup>
  </configSections>
  <fiftyOne>

    <!--<redirect> element controls how requests from mobile devices are handled.
    mobileHomePageUrl   Previously mobileRedirectUrl under the mobile/toolkit element.
                        A url to direct mobile devices to instead of the normal web sites 
                        landing page. (Optional)
    firstRequestOnly    If set to true only the first request received by the web site is
                        redirected to the mobileUrl when the site is accessed from a mobile
                        device. (Optional – defaults to true)
    timeout             The number of minutes of inactivity that should occur before the 
                        requesting device should be treated as making a new request to the
                        web site for the purposes of redirection. If the session is available
                        the session timeout will be used and override this value. (Optional
                        -defaults to 20 minutes)
    devicesFile	        A file used to store the details of devices that have previously
                        accessed the web site to determine if they're making a subsequent
                        request. Needed to ensure multiple worker processes have a consistent
                        view of previous activity. (Optional – random behaviour will be 
                        experienced if not specified on web sites with more than one worker
                        processes)
    mobilePagesRegex    A regular expression that when applied to the current request Path
                        (context.Request.AppRelativeCurrentExecutionFilePath) or the requesting 
                        Urlwill return true if it should be considered a mobile page. Use 
                        this attribute to tell redirection about mobile pages derived from base
                        classes such as System.Web.UI.Page. Redirection needs to be aware of
                        mobile pages so that requests to these pages can be ignored. Any page
                        that derives from System.Web.UI.MobileControls.MobilePage will 
                        automatically be treated as a mobile page irrespective of this 
                        attribute. (Optional)
    originalUrlAsQueryString
                        If set to true the redirected URL will have the original requesting Url 
                        encoded and included as the origUrl query string parameter in the 
                        redirected Url. This will enable the mobile home page to determine the 
                        original requested resource providing the option to display a mobile
                        friendly version. (Optional – defaults to false)
    locations/location  Provides details of different locations requests can be directed to based
                        on the values of defined properties associated with the device or request.
                        (Optional)
      url               the URL of the redirect location to use if all the properties in the 
                        collection match. (Mandatory)
      replaceExpression can be used to provide a regular expression which will take the requesting
                        URL as input and replace matching fragments with the contents of the url
                        attribute. (Optional)                       
                        The location element contains a collection of criteria that all need to match 
                        for the location to be used. Two attributes must be specified with each entry.
      property          the property of HttpRequest, HttpRequest.Browser or WURFL capability to 
                        use when evaluating the matchExpression attribute. (Mandatory)
      matchExpression   a regular expression used to evaluate the value of the property. (Mandatory)                        
                        -->

    <redirect firstRequestOnly="true"
              mobileHomePageUrl="~/Mobile/Default.aspx"
              timeout="20"
              devicesFile="~/App_Data/Devices.dat"
              mobilePagesRegex="/[Mobile|Tablet]/">
      <locations>
        <!-- Don't redirect requests that have the noredirect query string parameter.-->
        <location url="" replaceExpression="&amp;noredirect|noredirect&amp;|(?&lt;=\?)noredirect">
          <add property="Url" matchExpression="[&amp;|\?]noredirect"/>
        </location>
        <!-- Send tablets to their own home page. -->
        <location url="~/Tablet/Default.aspx">
          <add property="is_tablet" matchExpression="true"/>
        </location>
      </locations>
    </redirect>
    
    <!--<log> element controls where and how much information should be recorded in the log.    
    logFile   The location of the log file. (Mandatory)
    logLevel  Values include Debug|Info|Warn|Fatal and control the level of information
              logged. Detauls to Fatal if not specified. (Optional)-->
    
    <log logFile="~/App_Data/Log.txt"
         logLevel="Info"/>

    
    <!--<wurfl> element controls device data and new device handling.
    wurflFilePath         is the path of the main wurfl file (mandatory).
    wurflPatches          defines where any additional patch files can be located (optional).
    newDevicesURL         provides a URL where new devices found on your server can be recorded
                          (optional).
    newDeviceDetail       can be "minimum" or "maximum" and controls the HTTP header 
                          information sent to location defined in newDevicesUrl (optional).
    useActualDeviceRoot   When set to true only Wurfl devices marked with the attribute "actual_device_root"
                          are used to provide capabilities. Child devices will continue to be used to 
                          for device matching but their capabilities will not be used. This is an advanced
                          feature for those familar with WURFL. (optional)  
    capabilitiesWhiteList Using the capabilityName attribute of the add elements lists the Wurfl capabilities
                          required by the mobile web application. Providing this list prevents the entire list
                          of capabilities from being loaded slightly improving performance.-->
    
    <wurfl wurflFilePath="~/App_Data/wurfl.xml.gz"
           newDeviceDetail="maximum"
           newDevicesURL="http://devices.51degrees.mobi/new.ashx"
           useActualDeviceRoot="false">
      <capabilitiesWhiteList>
        <add capabilityName="pointing_method"/>
      </capabilitiesWhiteList>
      <wurflPatches>
        <add name="browser_definitions"
               filePath="~/App_Data/web_browsers_patch.xml"
               enabled="true"/>
      </wurflPatches>
    </wurfl>
  </fiftyOne>
  <system.web>
    <compilation debug="true">
    </compilation>
    <!-- IIS 6.0 & Visual Studio - Registers a module that is used to detect any new requests to the web site.
    Without this module mobile detection and redirection won't work.-->
    <httpModules>
      <add name="Detector" type="FiftyOne.Foundation.Mobile.Detection.DetectorModule, FiftyOne.Foundation"/>
    </httpModules>
    <trust level="Full" originUrl="http://localhost:5151/Default.aspx|http://localhost/Detector/Default.aspx|http://devices.51degrees.mobi/new.ashx"/>
  </system.web>
  <system.webServer>
    <!-- IIS 7.X - Registers a module that is used to detect any new requests to the web site.
    Without this module mobile detection and redirection won't work.-->
    <modules>
      <remove name="Detector"/>
      <add name="Detector" type="FiftyOne.Foundation.Mobile.Detection.DetectorModule, FiftyOne.Foundation"/>
    </modules>
  </system.webServer>
  <applicationSettings>
    <Detector.Properties.Settings>
      <setting name="Detector_WebService_MobileDevice" serializeAs="String">
        <value>http://localhost/Detector/MobileDevice.asmx</value>
      </setting>
    </Detector.Properties.Settings>
  </applicationSettings>
</configuration>
